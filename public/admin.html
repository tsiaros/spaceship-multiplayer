<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: #1a1a1a; color: white; padding: 20px; }
#loginPanel { max-width: 400px; margin: 100px auto; background: #2a2a2a; padding: 30px; border-radius: 10px; }
#adminPanel { display: none; max-width: 1200px; margin: 0 auto; }
h1 { color: #00ffff; margin-bottom: 20px; }
h2 { color: #00ffff; margin: 30px 0 15px 0; font-size: 18px; }
h3 { font-size: 16px; color: #00ffff; margin-top: 20px; }
input[type="password"], input[type="text"] { width: 100%; padding: 12px; border-radius: 5px; border: none; margin-bottom: 10px; font-size: 14px; }
button { padding: 12px 20px; background: #00ffff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: black; font-size: 14px; }
button:hover { background: #00dddd; }
button.danger { background: #ff4444; color: white; margin-left: 5px; }
button.danger:hover { background: #dd2222; }
button.warning { background: #ffaa00; color: black; margin-left: 5px; }
button.warning:hover { background: #dd8800; }
.error { color: #ff4444; margin-top: 10px; font-size: 14px; }
.success { color: #00ff00; margin-top: 10px; font-size: 14px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; background: #2a2a2a; }
th, td { padding: 12px; text-align: left; border-bottom: 1px solid #444; }
th { background: #333; color: #00ffff; }
.status { display: inline-block; padding: 4px 8px; border-radius: 3px; font-size: 12px; }
.status.online { background: #00ff00; color: black; }
.status.banned { background: #ff4444; color: white; }
.status.kicked { background: #ffaa00; color: black; }
#stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
.stat-card { background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center; }
.stat-value { font-size: 32px; color: #00ffff; font-weight: bold; }
.stat-label { font-size: 14px; color: #888; margin-top: 5px; }
#refreshBtn { float: right; }
.word-list { background: #2a2a2a; padding: 15px; border-radius: 8px; margin-top: 10px; max-height: 200px; overflow-y: auto; }
.word-tag { display: inline-block; background: #ff4444; color: white; padding: 5px 10px; border-radius: 4px; margin: 5px; font-size: 12px; }
.word-tag button { background: none; border: none; color: white; margin-left: 8px; cursor: pointer; padding: 0; font-size: 14px; }
.add-word-section { margin-top: 10px; display: flex; gap: 10px; }
.add-word-section input { flex: 1; margin-bottom: 0; }
#spectatorNote { background: rgba(255, 170, 0, 0.2); padding: 10px; border-radius: 5px; border-left: 4px solid #ffaa00; margin: 15px 0; font-size: 13px; }
.attack-off { outline: none; }
.attack-on { outline: 3px solid #00ff00; box-shadow: 0 0 10px #00ff00; }
.attack-auto { outline: 3px solid #ffff00; box-shadow: 0 0 10px #ffff00; }
</style>
</head>
<body>
<div id="loginPanel">
<h1>üîí Admin Login</h1>
<input type="password" id="adminPassword" placeholder="Password">
<button onclick="login()">Login</button>
<div id="loginError" class="error"></div>
<p style="font-size: 12px; color: #888; margin-top: 20px;">Password: <code>3310</code></p>
</div>
<div id="adminPanel">
<h1>‚öôÔ∏è Admin Panel</h1>
<div id="spectatorNote">
<strong>üí° OBS Browser Source:</strong> Open <a href="/spectator.html" target="_blank" style="color: #00ffff;">/spectator.html</a> ‚Üí Set 2560x1440 in OBS
</div>
<div id="stats">
<div class="stat-card"><div class="stat-value" id="statPlayers">0</div><div class="stat-label">Online Players</div></div>
<div class="stat-card"><div class="stat-value" id="statBanned">0</div><div class="stat-label">Banned Users</div></div>
<div class="stat-card"><div class="stat-value" id="statKicked">0</div><div class="stat-label">Kicked (24h)</div></div>
</div>
<button id="refreshBtn" onclick="refreshData()">üîÑ Refresh</button>
<h2>Online Players</h2>
<div id="actionMsg" class="success"></div>
<table><thead><tr><th>Name</th><th>Color</th><th>Kills</th><th>Health</th><th>Ship</th><th>Actions</th></tr></thead>
<tbody id="playerList"><tr><td colspan="6" style="text-align: center; color: #888;">Loading...</td></tr></tbody></table>
<h2>Banned Words</h2>
<div class="word-list" id="bannedWords">Loading...</div>
<div class="add-word-section"><input type="text" id="newWord" placeholder="Add banned word" maxlength="30"><button onclick="addBannedWord()">Add Word</button></div>
<h2>Banned Users</h2>
<table><thead><tr><th>Username</th><th>Status</th></tr></thead>
<tbody id="bannedList"><tr><td colspan="2" style="text-align: center; color: #888;">None</td></tr></tbody></table>
<h2>Kicked Users (24h)</h2>
<table><thead><tr><th>Username</th><th>Expires</th></tr></thead>
<tbody id="kickedList"><tr><td colspan="2" style="text-align: center; color: #888;">None</td></tr></tbody></table>
<h2>NPC Management</h2>
<div style="margin-bottom: 20px;">
<button onclick="spawnEnemy()">üõ∏ Spawn Enemy</button>
<button onclick="spawnBoss()" style="background: #ff4444; color: white;">üëæ Spawn Boss</button>
<button id="npcAutoBtn" onclick="toggleNPCAutoSpawn()" style="background: #9944ff; color: white;">ü§ñ AUTO</button>
<button onclick="deleteAllNPCs()" class="danger">üóëÔ∏è Delete All NPCs</button>
</div>
<h3>Attack Patterns</h3>
<div style="margin-bottom: 20px;">
<button id="clockBtn" onclick="toggleClock()" style="margin-right: 10px;">üïê Clock</button>
<button id="xBtn" onclick="toggleX()">‚ùå X Beams</button>
</div>
<h3>Active NPCs</h3>
<table><thead><tr><th>Type</th><th>Health</th><th>Actions</th></tr></thead>
<tbody id="npcList"><tr><td colspan="3" style="text-align: center; color: #888;">No NPCs</td></tr></tbody></table>
<h3>NPC Death Log</h3>
<button onclick="clearDeaths()" style="margin-bottom: 10px;">Clear Log</button>
<table><thead><tr><th>NPC Type</th><th>Killed By</th></tr></thead>
<tbody id="deathLog"><tr><td colspan="2" style="text-align: center; color: #888;">No deaths</td></tr></tbody></table>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io(window.location.origin);
let isAuthenticated = false;
let bannedWords = [];

socket.on('adminAuthenticated', () => {
  isAuthenticated = true;
  document.getElementById('loginPanel').style.display = 'none';
  document.getElementById('adminPanel').style.display = 'block';
  refreshData();
  socket.emit('adminGetBannedWords');
  socket.emit('adminGetNPCs');
});

socket.on('adminError', (msg) => { document.getElementById('loginError').textContent = msg; });

socket.on('adminPlayerList', (data) => {
  updatePlayerList(data.players);
  updateBannedList(data.banned);
  updateKickedList(data.kicked);
  updateStats(data);
});

socket.on('adminActionSuccess', (msg) => {
  const msgEl = document.getElementById('actionMsg');
  msgEl.textContent = msg;
  msgEl.style.display = 'block';
  setTimeout(() => { msgEl.style.display = 'none'; }, 3000);
  refreshData();
});

socket.on('adminNPCList', (data) => {
  updateNPCList(data.npcs);
  updateDeathLog(data.deaths);
});

socket.on('bannedWordsUpdate', (words) => {
  bannedWords = words;
  displayBannedWords();
});

socket.on('adminClockStatus', (data) => {
  const btn = document.getElementById('clockBtn');
  btn.className = `attack-${data.mode}`;
});

socket.on('adminXStatus', (data) => {
  const btn = document.getElementById('xBtn');
  btn.className = `attack-${data.mode}`;
});

socket.on('adminNPCAutoStatus', (data) => {
  const btn = document.getElementById('npcAutoBtn');
  if (data.active) {
    btn.style.outline = '3px solid #00ff00';
    btn.style.boxShadow = '0 0 10px #00ff00';
  } else {
    btn.style.outline = 'none';
    btn.style.boxShadow = 'none';
  }
});

function login() {
  const password = document.getElementById('adminPassword').value;
  socket.emit('adminLogin', password);
}

function refreshData() {
  if (!isAuthenticated) return;
  socket.emit('adminGetPlayers');
}

function updateStats(data) {
  document.getElementById('statPlayers').textContent = data.players.length;
  document.getElementById('statBanned').textContent = data.banned.length;
  document.getElementById('statKicked').textContent = data.kicked.length;
}

function updatePlayerList(players) {
  const tbody = document.getElementById('playerList');
  if (players.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #888;">No players online</td></tr>';
    return;
  }
  tbody.innerHTML = players.map(p => `
    <tr>
      <td><strong>${p.name}</strong></td>
      <td><span style="color: ${p.color};">‚óè</span> ${p.color}</td>
      <td>${p.kills}</td>
      <td>${p.health}/6</td>
      <td>${p.shipSize}</td>
      <td>
        <button class="warning" onclick="kickPlayer('${p.name}')">Kick 24h</button>
        <button class="danger" onclick="banPlayer('${p.name}')">Ban</button>
      </td>
    </tr>
  `).join('');
}

function updateBannedList(banned) {
  const tbody = document.getElementById('bannedList');
  if (banned.length === 0) {
    tbody.innerHTML = '<tr><td colspan="2" style="text-align: center; color: #888;">None</td></tr>';
    return;
  }
  tbody.innerHTML = banned.map(([name, expiry]) => `
    <tr><td>${name}</td><td><span class="status banned">BANNED</span></td></tr>
  `).join('');
}

function updateKickedList(kicked) {
  const tbody = document.getElementById('kickedList');
  if (kicked.length === 0) {
    tbody.innerHTML = '<tr><td colspan="2" style="text-align: center; color: #888;">None</td></tr>';
    return;
  }
  tbody.innerHTML = kicked.map(([name, expiry]) => {
    const timeLeft = Math.ceil((expiry - Date.now()) / (1000 * 60 * 60));
    return `<tr><td>${name}</td><td><span class="status kicked">~${timeLeft}h left</span></td></tr>`;
  }).join('');
}

function kickPlayer(name) {
  if (!confirm(`Kick ${name} for 24 hours?`)) return;
  socket.emit('adminKick', name);
}

function banPlayer(name) {
  if (!confirm(`Permanently ban ${name}?`)) return;
  socket.emit('adminBan', name);
}

function addBannedWord() {
  const word = document.getElementById('newWord').value.trim().toLowerCase();
  if (!word) return;
  socket.emit('adminAddBannedWord', word);
  document.getElementById('newWord').value = '';
}

function removeBannedWord(word) {
  if (!confirm(`Remove "${word}"?`)) return;
  socket.emit('adminRemoveBannedWord', word);
}

function displayBannedWords() {
  const container = document.getElementById('bannedWords');
  if (bannedWords.length === 0) {
    container.innerHTML = '<p style="color: #888;">Default list active</p>';
    return;
  }
  container.innerHTML = bannedWords.map(word => `
    <span class="word-tag">${word}<button onclick="removeBannedWord('${word}')">‚úï</button></span>
  `).join('');
}

function spawnEnemy() { socket.emit('adminSpawnEnemy'); }
function spawnBoss() { socket.emit('adminSpawnBoss'); }
function deleteAllNPCs() {
  if (!confirm('Delete all NPCs?')) return;
  socket.emit('adminDeleteAllNPCs');
}
function clearDeaths() {
  if (!confirm('Clear death log?')) return;
  socket.emit('adminClearDeaths');
}
function toggleClock() { socket.emit('adminToggleClock'); }
function toggleX() { socket.emit('adminToggleX'); }
function toggleNPCAutoSpawn() { socket.emit('adminToggleNPCAutoSpawn'); }
function deleteNPC(npcId) {
  if (!confirm('Delete this NPC?')) return;
  socket.emit('adminDeleteNPC', npcId);
}

function updateNPCList(npcList) {
  const tbody = document.getElementById('npcList');
  if (npcList.length === 0) {
    tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #888;">No NPCs</td></tr>';
    return;
  }
  tbody.innerHTML = npcList.map(npc => `
    <tr>
      <td><strong>${npc.type === 'boss' ? 'üëæ Boss' : 'üõ∏ Enemy'}</strong></td>
      <td>${npc.health}/${npc.maxHealth}</td>
      <td><button class="danger" onclick="deleteNPC('${npc.id}')">Delete</button></td>
    </tr>
  `).join('');
}

function updateDeathLog(deaths) {
  const tbody = document.getElementById('deathLog');
  if (deaths.length === 0) {
    tbody.innerHTML = '<tr><td colspan="2" style="text-align: center; color: #888;">No deaths</td></tr>';
    return;
  }
  tbody.innerHTML = deaths.slice(-20).reverse().map(death => `
    <tr>
      <td>${death.npcType === 'boss' ? 'üëæ Boss' : 'üõ∏ Enemy'}</td>
      <td>${death.killerName}</td>
    </tr>
  `).join('');
}

setInterval(() => {
  if (isAuthenticated) refreshData();
}, 3000);

document.getElementById('adminPassword').addEventListener('keypress', e => {
  if (e.key === 'Enter') login();
});

document.getElementById('newWord').addEventListener('keypress', e => {
  if (e.key === 'Enter') addBannedWord();
});
</script>
</body>
</html>
